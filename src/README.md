## Esquema da aplicaÃ§Ã£o
![Esquema da aplicaÃ§Ã£o](img/20250801225137.png)

## Comandos
- `docker-compose up` para iniciar os containers do Docker (executar no diretÃ³rio em que se encontra o arquivo `docker-compose.yml`)

## Iniciando o Grafana
- UsuÃ¡rio e senha padrÃ£o do Grafana: _admin_
- 1Âº Configurar o data source
    - Prometheus: http://prometheus-forum-api:9090
- 2Âº Criar pasta para dashboards
- 3Âº Criar dashboard (acessar configuraÃ§Ãµes do dashboard para definir tÃ­tulo, descriÃ§Ã£o, tags e etc.)
- 4Âº Criar variÃ¡vel (opcional) em configuraÃ§Ãµes do dashboard
    - Tipo de variÃ¡vel: `query`
    - Nome: `application`
    - Data source: `Prometheus`
    - Tipo de query: `label values`
    - Label: `application` (conforme definido em `management.metrics.tags.application` da aplicaÃ§Ã£o)
    - Preview serÃ¡ gerado automaticamente (`app-forum-api`)
- 5Âº Criar variÃ¡vel (opcional) em configuraÃ§Ãµes do dashboard
    - Tipo de variÃ¡vel: `query`
    - Nome: `instance`
    - Data source: `Prometheus`
    - Tipo de query: `label values`
    - Label: `instance`
    - Metric: `jvm_classes_loaded_classes`
    - Label filters: 
        - `application` = `$application` (variÃ¡vel criada anteriormente)
    - Preview serÃ¡ gerado automaticamente (`app-forum-api:8080`)
- 6Âº Criar variÃ¡vel (opcional) em configuraÃ§Ãµes do dashboard
    - Tipo de variÃ¡vel: `query`
    - Nome: `pool`
    - Data source: `Prometheus`
    - Tipo de query: `label values`
    - Label: `pool`
    - Metric: `hikaricp_connections`
    - Label filters: 
        - `application` = `$application` (variÃ¡vel criada anteriormente)
        - `instance` = `$instance` (variÃ¡vel criada anteriormente)
    - Preview serÃ¡ gerado automaticamente (`HikariPool-1`)
- 7Âº Adicionar nova linha ao dashboard
    - TÃ­tulo: `API BASIC`
- 8Âº Adicionar painel/visualizaÃ§Ã£o
    - Queries
        - Data source: `Prometheus`
        - Metric: `process_uptime_seconds`
        - Label filters:
            - `application` = `$application` (variÃ¡vel criada anteriormente)
            - `instance` = `$instance` (variÃ¡vel criada anteriormente)
            - `job` = `api-forum-api`
    - VisualizaÃ§Ã£o: `EstatÃ­stica (Stat)`
        - OpÃ§Ãµes do painel
            - TÃ­tulo: `UPTIME`
            - DescriÃ§Ã£o: `API uptime`
        - OpÃ§Ãµes de valores
            - CÃ¡lculo: `Ãšltimo nÃ£o nulo`
            - Modo grÃ¡fico: `nenhum`
        - OpÃ§Ãµes padrÃµes
            - Unidade: `Tempo` > `duraÃ§Ã£o (hh:mm:ss)`
        - Limites
            - Apenas item base: ğŸ”µ
- 9Âº Adicionar painel/visualizaÃ§Ã£o
    - Queries
        - Data source: `Prometheus`
        - Metric: `process_start_time_seconds`
        - Label filters:
            - `application` = `$application` (variÃ¡vel criada anteriormente)
            - `instance` = `$instance` (variÃ¡vel criada anteriormente)
            - `job` = `api-forum-api`
        - OperaÃ§Ã£o: `OperaÃ§Ãµes binÃ¡rias` > `Multiplicar por escalar` = 1000
    - VisualizaÃ§Ã£o: `EstatÃ­stica (Stat)`
        - OpÃ§Ãµes do painel
            - TÃ­tulo: `START TIME`
            - DescriÃ§Ã£o: `Hora da inicializaÃ§Ã£o da API`
        - OpÃ§Ãµes de valores
            - CÃ¡lculo: `Ãšltimo nÃ£o nulo`
            - Modo grÃ¡fico: `nenhum`
        - OpÃ§Ãµes padrÃµes
            - Unidade: `Data e hora` > `Data e hora local (Sem data se for hoje)`
        - Limites
            - Apenas item base: ğŸ”µ
- 10Âº Adicionar painel/visualizaÃ§Ã£o
    - Queries
        - Query Warn
            - Data source: `Prometheus`
            - Metric: `logback_events_total`
            - Label filters:
                - `application` = `$application` (variÃ¡vel criada anteriormente)
                - `instance` = `$instance` (variÃ¡vel criada anteriormente)
                - `job` = `api-forum-api`
                - `level` = `warn`
            - OperaÃ§Ã£o: `FunÃ§Ãµes de alcance` > `Aumentar` = 5m
            - OperaÃ§Ã£o: `AgregaÃ§Ã£o` > `Soma` > `RÃ³tulo` = `level`
            - OpÃ§Ãµes
                - Legenda: `Customizada` = `{{level}}`
            - Cor: ğŸŸ¡
        - Query Error
            - Data source: `Prometheus`
            - Metric: `logback_events_total`
            - Label filters:
                - `application` = `$application` (variÃ¡vel criada anteriormente)
                - `instance` = `$instance` (variÃ¡vel criada anteriormente)
                - `job` = `api-forum-api`
                - `level` = `error`
            - OperaÃ§Ã£o: `FunÃ§Ãµes de alcance` > `Aumentar` = 5m
            - OperaÃ§Ã£o: `AgregaÃ§Ã£o` > `Soma` > `RÃ³tulo` = `level`
            - OpÃ§Ãµes
                - Legenda: `Customizada` = `{{level}}`
            - Cor: ğŸ”´
    - VisualizaÃ§Ã£o: `SÃ©rie temporal (Time series)`
        - OpÃ§Ãµes do painel
            - TÃ­tulo: `WARN & ERROR LOG`
            - DescriÃ§Ã£o: `Warnings e erros logados nos Ãºltimos 5 minutos`
        - Legenda
            - Modo: `Tabela`
            - Valores: `Min`, `Max`, `Last *`, `Total`
        - Estilos de grÃ¡fico
            - Opacidade de preenchimento: 10
            - Modo gradiente: `Opacidade`
            - Mostrar pontos: `Nunca`
        - OpÃ§Ãµes padrÃµes
            - Unidade: `Diversos` > `Curto`
            - Decimais: 0
- 11Âº Adicionar painel/visualizaÃ§Ã£o
    - Queries
        - Data source: `Prometheus`
        - Metric: `hikaricp_connections`
        - Label filters:
            - `application` = `$application` (variÃ¡vel criada anteriormente)
            - `instance` = `$instance` (variÃ¡vel criada anteriormente)
            - `job` = `api-forum-api`
    - VisualizaÃ§Ã£o: `EstatÃ­stica (Stat)`
        - OpÃ§Ãµes do painel
            - TÃ­tulo: `JDBC POOL`
            - DescriÃ§Ã£o: `Pool de conexÃµes JDBC`
        - OpÃ§Ãµes de valores
            - CÃ¡lculo: `Ãšltimo nÃ£o nulo`
        - Estilos de estatÃ­sticas
            - Modo grÃ¡fico: `nenhum`
        - OpÃ§Ãµes padrÃµes
            - Unidade: `Diversos` > `Curto`
        - Limites
            - Base: ğŸ”´
            - Normal: ğŸŸ¢
                - Valor padrÃ£o: 10
- 12Âº Adicionar painel/visualizaÃ§Ã£o
    - Queries
        - Data source: `Prometheus`
        - Metric: `auth_user_success_total`
        - Label filters:
            - `application` = `$application` (variÃ¡vel criada anteriormente)
            - `instance` = `$instance` (variÃ¡vel criada anteriormente)
            - `job` = `api-forum-api`
        - OperaÃ§Ã£o: `FunÃ§Ãµes de alcance` > `Aumentar` = 1m
    - VisualizaÃ§Ã£o: `EstatÃ­stica (Stat)`
        - OpÃ§Ãµes do painel
            - TÃ­tulo: `USERS LOGGED`
            - DescriÃ§Ã£o: `UsuÃ¡rios logados no Ãºltimo minuto`
        - OpÃ§Ãµes de valores
            - CÃ¡lculo: `Ãšltimo nÃ£o nulo`
        - Estilos de estatÃ­sticas
            - Modo grÃ¡fico: `nenhum`
        - OpÃ§Ãµes padrÃµes
            - Unidade: `Diversos` > `Curto`
            - Decimais: 0
        - Limites
            - Base: ğŸŸ¢
- 13Âº Adicionar painel/visualizaÃ§Ã£o
    - Queries
        - Data source: `Prometheus`
        - Metric: `auth_user_error_total`
        - Label filters:
            - `application` = `$application` (variÃ¡vel criada anteriormente)
            - `instance` = `$instance` (variÃ¡vel criada anteriormente)
            - `job` = `api-forum-api`
        - OperaÃ§Ã£o: `FunÃ§Ãµes de alcance` > `Aumentar` = 1m
    - VisualizaÃ§Ã£o: `EstatÃ­stica (Stat)`
        - OpÃ§Ãµes do painel
            - TÃ­tulo: `AUTH ERRORS`
            - DescriÃ§Ã£o: `Erros de autenticaÃ§Ã£o no Ãºltimo minuto`
        - OpÃ§Ãµes de valores
            - CÃ¡lculo: `Ãšltimo nÃ£o nulo`
        - Estilos de estatÃ­sticas
            - Modo grÃ¡fico: `nenhum`
        - OpÃ§Ãµes padrÃµes
            - Unidade: `Diversos` > `Curto`
            - Decimais: 0
        - Limites
            - Base: ğŸŸ¢
            - Alerta: ğŸŸ 
                - Valor padrÃ£o: 5
            - CrÃ­tico: ğŸ”´
                - Valor padrÃ£o: 10
- 14Âº Adicionar painel/visualizaÃ§Ã£o
    - Queries
        - Query Active
            - Data source: `Prometheus`
            - Metric: `hikaricp_connections_active`
            - Label filters:
                - `application` = `$application` (variÃ¡vel criada anteriormente)
                - `instance` = `$instance` (variÃ¡vel criada anteriormente)
                - `job` = `api-forum-api`
                - `pool` = `$pool` (variÃ¡vel criada anteriormente)`
            - OpÃ§Ãµes
                - Legenda: `active`
            - Cor: ğŸŸ¢
        - Query Idle
            - Data source: `Prometheus`
            - Metric: `hikaricp_connections_idle`
            - Label filters:
                - `application` = `$application` (variÃ¡vel criada anteriormente)
                - `instance` = `$instance` (variÃ¡vel criada anteriormente)
                - `job` = `api-forum-api`
                - `pool` = `$pool` (variÃ¡vel criada anteriormente)`
            - OpÃ§Ãµes
                - Legenda: `idle`
            - Cor: ğŸŸ¡
        - Query Pending
            - Data source: `Prometheus`
            - Metric: `hikaricp_connections_pending`
            - Label filters:
                - `application` = `$application` (variÃ¡vel criada anteriormente)
                - `instance` = `$instance` (variÃ¡vel criada anteriormente)
                - `job` = `api-forum-api`
                - `pool` = `$pool` (variÃ¡vel criada anteriormente)`
            - OpÃ§Ãµes
                - Legenda: `pending`
            - Cor: ğŸ”µ
    - VisualizaÃ§Ã£o: `SÃ©rie temporal (Time series)`
        - OpÃ§Ãµes do painel
            - TÃ­tulo: `CONNECTION STATE`
            - DescriÃ§Ã£o: `Estado das conexÃµes com o database`
        - Legenda
            - Modo: `Tabela`
            - Posicionamento da legenda: `Direita`
            - Valores: `Min`, `Max`, `Last *`
        - Estilos de grÃ¡fico
            - Opacidade de preenchimento: 10
            - Modo gradiente: `Opacidade`
            - Mostrar pontos: `Nunca`
        - OpÃ§Ãµes padrÃµes
            - Unidade: `Diversos` > `Curto`
        - Limites
            - Base: ğŸŸ¢
- 15Âº Adicionar painel/visualizaÃ§Ã£o
    - Queries
        - Data source: `Prometheus`
        - Metric: `hikaricp_connections_timeout_total`
        - Label filters:
            - `application` = `$application` (variÃ¡vel criada anteriormente)
            - `instance` = `$instance` (variÃ¡vel criada anteriormente)
            - `job` = `api-forum-api`
            - `pool` = `$pool` (variÃ¡vel criada anteriormente)`
        - OperaÃ§Ã£o: `FunÃ§Ãµes de alcance` > `Aumentar` = 1m
    - VisualizaÃ§Ã£o: `EstatÃ­stica (Stat)`
        - OpÃ§Ãµes do painel
            - TÃ­tulo: `DB CONNECTION TIMEOUT`
            - DescriÃ§Ã£o: `ConexÃµes com o database em timeout`
        - OpÃ§Ãµes de valores
            - CÃ¡lculo: `Ãšltimo nÃ£o nulo`
        - Estilos de estatÃ­sticas
            - Modo grÃ¡fico: `nenhum`
        - OpÃ§Ãµes padrÃµes
            - Unidade: `Diversos` > `Curto`
            - Decimais: 0
        - Limites
            - Base: ğŸŸ¢
            - CrÃ­tico: ğŸ”´
                - Valor padrÃ£o: 2
- 16Âº Adicionar nova linha ao dashboard
    - TÃ­tulo: `API RED`
- 17Âº Adicionar painel/visualizaÃ§Ã£o
    - Queries
        - Data source: `Prometheus`
        - Metric: `http_server_requests_seconds_count`
        - Label filters:
            - `application` = `$application` (variÃ¡vel criada anteriormente)
            - `instance` = `$instance` (variÃ¡vel criada anteriormente)
            - `job` = `api-forum-api`
            <!-- - `uri` != `/actuator/prometheus` -->
        - OperaÃ§Ã£o: `FunÃ§Ãµes de alcance` > `Aumentar` = 1m
        - OperaÃ§Ã£o: `AgregaÃ§Ã£o` > `Soma`
    - VisualizaÃ§Ã£o: `EstatÃ­stica (Stat)`
        - OpÃ§Ãµes do painel
            - TÃ­tulo: `TOTAL REQUESTS`
            - DescriÃ§Ã£o: `NÃºmero de requisiÃ§Ãµes no Ãºltimo minuto`
        - OpÃ§Ãµes de valores
            - CÃ¡lculo: `Ãšltimo nÃ£o nulo`
        - Estilos de estatÃ­sticas
            - Modo grÃ¡fico: `nenhum`
        - OpÃ§Ãµes padrÃµes
            - Unidade: `Diversos` > `Curto`
        - Limites
            - Base: ğŸ”´
            - Alerta: ğŸŸ 
                - Valor padrÃ£o: 30
            - AceitÃ¡vel: ğŸŸ¢
                - Valor padrÃ£o: 60
- 18Âº Adicionar painel/visualizaÃ§Ã£o
    - Queries
        - Data source: `Prometheus`
        - Metric: `http_server_requests_seconds_sum`
        - Label filters:
            - `application` = `$application` (variÃ¡vel criada anteriormente)
            - `instance` = `$instance` (variÃ¡vel criada anteriormente)
            - `job` = `api-forum-api`
            - `uri` != `/actuator/prometheus`
        - OperaÃ§Ã£o: `FunÃ§Ãµes de alcance` > `Avaliar` = 1m
        - Operador: `/`
        - Metric: `http_server_requests_seconds_count`
        - Label filters:
            - `application` = `$application` (variÃ¡vel criada anteriormente)
            - `instance` = `$instance` (variÃ¡vel criada anteriormente)
            - `job` = `api-forum-api`
            - `uri` != `/actuator/prometheus`
        - OperaÃ§Ã£o: `FunÃ§Ãµes de alcance` > `Avaliar` = 1m
        - OpÃ§Ãµes
            - Legenda: `Customizada` = `{{uri}} {{method}} {{status}}`
    - VisualizaÃ§Ã£o: `SÃ©rie temporal (Time series)`
        - OpÃ§Ãµes do painel
            - TÃ­tulo: `RESPONSE TIME`
            - DescriÃ§Ã£o: `Tempo de resposta no Ãºltimo minuto`
            - Legenda
                - Modo: `Tabela`
                - Posicionamento da legenda: `Direita`
                - Valores: `Min`, `Max`, `Mean`, `Last *`
        - Estilos de grÃ¡fico
            - Opacidade de preenchimento: 10
            - Modo gradiente: `Opacidade`
            - Mostrar pontos: `Nunca`
        - OpÃ§Ãµes padrÃµes
            - Unidade: `Tempo` > `segundo(s)`
        - Limites
            - Base: ğŸŸ¢