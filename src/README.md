## Esquema da aplica√ß√£o
![Esquema da aplica√ß√£o](img/20250801225137.png)

## Comandos
- `docker-compose up` para iniciar os containers do Docker (executar no diret√≥rio em que se encontra o arquivo `docker-compose.yml`)

## Iniciando o Grafana
- Usu√°rio e senha padr√£o do Grafana: _admin_
- 1¬∫ Configurar o data source
    - Prometheus: http://prometheus-forum-api:9090
- 2¬∫ Criar pasta para dashboards
- 3¬∫ Criar dashboard (acessar configura√ß√µes do dashboard para definir t√≠tulo, descri√ß√£o, tags e etc.)
- 4¬∫ Criar vari√°vel (opcional) em configura√ß√µes do dashboard
    - Tipo de vari√°vel: `query`
    - Nome: `application`
    - Data source: `Prometheus`
    - Tipo de query: `label values`
    - Label: `application` (conforme definido em `management.metrics.tags.application` da aplica√ß√£o)
    - Preview ser√° gerado automaticamente (`app-forum-api`)
- 5¬∫ Criar vari√°vel (opcional) em configura√ß√µes do dashboard
    - Tipo de vari√°vel: `query`
    - Nome: `instance`
    - Data source: `Prometheus`
    - Tipo de query: `label values`
    - Label: `instance`
    - Metric: `jvm_classes_loaded_classes`
    - Label filters: 
        - `application` = `$application` (vari√°vel criada anteriormente)
    - Preview ser√° gerado automaticamente (`app-forum-api:8080`)
- 6¬∫ Criar vari√°vel (opcional) em configura√ß√µes do dashboard
    - Tipo de vari√°vel: `query`
    - Nome: `pool`
    - Data source: `Prometheus`
    - Tipo de query: `label values`
    - Label: `pool`
    - Metric: `hikaricp_connections`
    - Label filters: 
        - `application` = `$application` (vari√°vel criada anteriormente)
        - `instance` = `$instance` (vari√°vel criada anteriormente)
    - Preview ser√° gerado automaticamente (`HikariPool-1`)
- 7¬∫ Adicionar nova linha ao dashboard
    - T√≠tulo: `API BASIC`
- 8¬∫ Adicionar painel/visualiza√ß√£o
    - Queries
        - Data source: `Prometheus`
        - Metric: `process_uptime_seconds`
        - Label filters:
            - `application` = `$application` (vari√°vel criada anteriormente)
            - `instance` = `$instance` (vari√°vel criada anteriormente)
            - `job` = `api-forum-api`
    - Visualiza√ß√£o: `Estat√≠stica (Stat)`
        - Op√ß√µes do painel
            - T√≠tulo: `UPTIME`
            - Descri√ß√£o: `API uptime`
        - Op√ß√µes de valores
            - C√°lculo: `√öltimo n√£o nulo`
            - Modo gr√°fico: `nenhum`
        - Op√ß√µes padr√µes
            - Unidade: `Tempo` > `dura√ß√£o (hh:mm:ss)`
        - Limites
            - Apenas item base: üîµ
- 9¬∫ Adicionar painel/visualiza√ß√£o
    - Queries
        - Data source: `Prometheus`
        - Metric: `process_start_time_seconds`
        - Label filters:
            - `application` = `$application` (vari√°vel criada anteriormente)
            - `instance` = `$instance` (vari√°vel criada anteriormente)
            - `job` = `api-forum-api`
        - Opera√ß√£o: `Opera√ß√µes bin√°rias` > `Multiplicar por escalar` = 1000
    - Visualiza√ß√£o: `Estat√≠stica (Stat)`
        - Op√ß√µes do painel
            - T√≠tulo: `START TIME`
            - Descri√ß√£o: `Hora da inicializa√ß√£o da API`
        - Op√ß√µes de valores
            - C√°lculo: `√öltimo n√£o nulo`
            - Modo gr√°fico: `nenhum`
        - Op√ß√µes padr√µes
            - Unidade: `Data e hora` > `Data e hora local (Sem data se for hoje)`
        - Limites
            - Apenas item base: üîµ
- 10¬∫ Adicionar painel/visualiza√ß√£o
    - Queries
        - Query Warn
            - Data source: `Prometheus`
            - Metric: `logback_events_total`
            - Label filters:
                - `application` = `$application` (vari√°vel criada anteriormente)
                - `instance` = `$instance` (vari√°vel criada anteriormente)
                - `job` = `api-forum-api`
                - `level` = `warn`
            - Opera√ß√£o: `Fun√ß√µes de alcance` > `Aumentar` = 5m
            - Opera√ß√£o: `Agrega√ß√£o` > `Soma` > `R√≥tulo` = `level`
            - Op√ß√µes
                - Legenda: `Customizada` = `{{level}}`
            - Cor: üü°
        - Query Error
            - Data source: `Prometheus`
            - Metric: `logback_events_total`
            - Label filters:
                - `application` = `$application` (vari√°vel criada anteriormente)
                - `instance` = `$instance` (vari√°vel criada anteriormente)
                - `job` = `api-forum-api`
                - `level` = `error`
            - Opera√ß√£o: `Fun√ß√µes de alcance` > `Aumentar` = 5m
            - Opera√ß√£o: `Agrega√ß√£o` > `Soma` > `R√≥tulo` = `level`
            - Op√ß√µes
                - Legenda: `Customizada` = `{{level}}`
            - Cor: üî¥
    - Visualiza√ß√£o: `S√©rie temporal (Time series)`
        - Op√ß√µes do painel
            - T√≠tulo: `WARN & ERROR LOG`
            - Descri√ß√£o: `Warnings e erros logados nos √∫ltimos 5 minutos`
        - Legenda
            - Modo: `Tabela`
            - Valores: `Min`, `Max`, `Last *`, `Total`
        - Estilos de gr√°fico
            - Opacidade de preenchimento: 10
            - Modo gradiente: `Opacidade`
            - Mostrar pontos: `Nunca`
        - Op√ß√µes padr√µes
            - Unidade: `Diversos` > `Curto`
            - Decimais: 0
- 11¬∫ Adicionar painel/visualiza√ß√£o
    - Queries
        - Data source: `Prometheus`
        - Metric: `hikaricp_connections`
        - Label filters:
            - `application` = `$application` (vari√°vel criada anteriormente)
            - `instance` = `$instance` (vari√°vel criada anteriormente)
            - `job` = `api-forum-api`
    - Visualiza√ß√£o: `Estat√≠stica (Stat)`
        - Op√ß√µes do painel
            - T√≠tulo: `JDBC POOL`
            - Descri√ß√£o: `Pool de conex√µes JDBC`
        - Op√ß√µes de valores
            - C√°lculo: `√öltimo n√£o nulo`
        - Estilos de estat√≠sticas
            - Modo gr√°fico: `nenhum`
        - Op√ß√µes padr√µes
            - Unidade: `Diversos` > `Curto`
        - Limites
            - Base: üî¥
            - Normal: üü¢
                - Valor padr√£o: 10
- 12¬∫ Adicionar painel/visualiza√ß√£o
    - Queries
        - Data source: `Prometheus`
        - Metric: `auth_user_success_total`
        - Label filters:
            - `application` = `$application` (vari√°vel criada anteriormente)
            - `instance` = `$instance` (vari√°vel criada anteriormente)
            - `job` = `api-forum-api`
        - Opera√ß√£o: `Fun√ß√µes de alcance` > `Aumentar` = 1m
    - Visualiza√ß√£o: `Estat√≠stica (Stat)`
        - Op√ß√µes do painel
            - T√≠tulo: `USERS LOGGED`
            - Descri√ß√£o: `Usu√°rios logados no √∫ltimo minuto`
        - Op√ß√µes de valores
            - C√°lculo: `√öltimo n√£o nulo`
        - Estilos de estat√≠sticas
            - Modo gr√°fico: `nenhum`
        - Op√ß√µes padr√µes
            - Unidade: `Diversos` > `Curto`
            - Decimais: 0
        - Limites
            - Base: üü¢
- 13¬∫ Adicionar painel/visualiza√ß√£o
    - Queries
        - Data source: `Prometheus`
        - Metric: `auth_user_error_total`
        - Label filters:
            - `application` = `$application` (vari√°vel criada anteriormente)
            - `instance` = `$instance` (vari√°vel criada anteriormente)
            - `job` = `api-forum-api`
        - Opera√ß√£o: `Fun√ß√µes de alcance` > `Aumentar` = 1m
    - Visualiza√ß√£o: `Estat√≠stica (Stat)`
        - Op√ß√µes do painel
            - T√≠tulo: `AUTH ERRORS`
            - Descri√ß√£o: `Erros de autentica√ß√£o no √∫ltimo minuto`
        - Op√ß√µes de valores
            - C√°lculo: `√öltimo n√£o nulo`
        - Estilos de estat√≠sticas
            - Modo gr√°fico: `nenhum`
        - Op√ß√µes padr√µes
            - Unidade: `Diversos` > `Curto`
            - Decimais: 0
        - Limites
            - Base: üü¢
            - Alerta: üü†
                - Valor padr√£o: 5
            - Cr√≠tico: üî¥
                - Valor padr√£o: 10
- 14¬∫ Adicionar painel/visualiza√ß√£o
    - Queries
        - Query Active
            - Data source: `Prometheus`
            - Metric: `hikaricp_connections_active`
            - Label filters:
                - `application` = `$application` (vari√°vel criada anteriormente)
                - `instance` = `$instance` (vari√°vel criada anteriormente)
                - `job` = `api-forum-api`
                - `pool` = `$pool` (vari√°vel criada anteriormente)`
            - Op√ß√µes
                - Legenda: `active`
            - Cor: üü¢
        - Query Idle
            - Data source: `Prometheus`
            - Metric: `hikaricp_connections_idle`
            - Label filters:
                - `application` = `$application` (vari√°vel criada anteriormente)
                - `instance` = `$instance` (vari√°vel criada anteriormente)
                - `job` = `api-forum-api`
                - `pool` = `$pool` (vari√°vel criada anteriormente)`
            - Op√ß√µes
                - Legenda: `idle`
            - Cor: üü°
        - Query Pending
            - Data source: `Prometheus`
            - Metric: `hikaricp_connections_pending`
            - Label filters:
                - `application` = `$application` (vari√°vel criada anteriormente)
                - `instance` = `$instance` (vari√°vel criada anteriormente)
                - `job` = `api-forum-api`
                - `pool` = `$pool` (vari√°vel criada anteriormente)`
            - Op√ß√µes
                - Legenda: `pending`
            - Cor: üîµ
    - Visualiza√ß√£o: `S√©rie temporal (Time series)`
        - Op√ß√µes do painel
            - T√≠tulo: `CONNECTION STATE`
            - Descri√ß√£o: `Estado das conex√µes com o database`
        - Legenda
            - Modo: `Tabela`
            - Posicionamento da legenda: `Direita`
            - Valores: `Min`, `Max`, `Last *`
        - Estilos de gr√°fico
            - Opacidade de preenchimento: 10
            - Modo gradiente: `Opacidade`
            - Mostrar pontos: `Nunca`
        - Op√ß√µes padr√µes
            - Unidade: `Diversos` > `Curto`
        - Limites
            - Base: üü¢
- 15¬∫ Adicionar painel/visualiza√ß√£o
    - Queries
        - Data source: `Prometheus`
        - Metric: `hikaricp_connections_timeout_total`
        - Label filters:
            - `application` = `$application` (vari√°vel criada anteriormente)
            - `instance` = `$instance` (vari√°vel criada anteriormente)
            - `job` = `api-forum-api`
            - `pool` = `$pool` (vari√°vel criada anteriormente)`
        - Opera√ß√£o: `Fun√ß√µes de alcance` > `Aumentar` = 1m
    - Visualiza√ß√£o: `Estat√≠stica (Stat)`
        - Op√ß√µes do painel
            - T√≠tulo: `DB CONNECTION TIMEOUT`
            - Descri√ß√£o: `Conex√µes com o database em timeout`
        - Op√ß√µes de valores
            - C√°lculo: `√öltimo n√£o nulo`
        - Estilos de estat√≠sticas
            - Modo gr√°fico: `nenhum`
        - Op√ß√µes padr√µes
            - Unidade: `Diversos` > `Curto`
            - Decimais: 0
        - Limites
            - Base: üü¢
            - Cr√≠tico: üî¥
                - Valor padr√£o: 2
- 16¬∫ Adicionar nova linha ao dashboard
    - T√≠tulo: `API RED`
- 17¬∫ Adicionar painel/visualiza√ß√£o
    - Queries
        - Data source: `Prometheus`
        - Metric: `http_server_requests_seconds_count`
        - Label filters:
            - `application` = `$application` (vari√°vel criada anteriormente)
            - `instance` = `$instance` (vari√°vel criada anteriormente)
            - `job` = `api-forum-api`
            <!-- - `uri` != `/actuator/prometheus` -->
        - Opera√ß√£o: `Fun√ß√µes de alcance` > `Aumentar` = 1m
        - Opera√ß√£o: `Agrega√ß√£o` > `Soma`
    - Visualiza√ß√£o: `Estat√≠stica (Stat)`
        - Op√ß√µes do painel
            - T√≠tulo: `TOTAL REQUESTS`
            - Descri√ß√£o: `N√∫mero de requisi√ß√µes no √∫ltimo minuto`
        - Op√ß√µes de valores
            - C√°lculo: `√öltimo n√£o nulo`
        - Estilos de estat√≠sticas
            - Modo gr√°fico: `nenhum`
        - Op√ß√µes padr√µes
            - Unidade: `Diversos` > `Curto`
        - Limites
            - Base: üî¥
            - Alerta: üü†
                - Valor padr√£o: 30
            - Aceit√°vel: üü¢
                - Valor padr√£o: 60
- 18¬∫ Adicionar painel/visualiza√ß√£o
    - Queries
        - Data source: `Prometheus`
        - Metric: `http_server_requests_seconds_sum`
        - Label filters:
            - `application` = `$application` (vari√°vel criada anteriormente)
            - `instance` = `$instance` (vari√°vel criada anteriormente)
            - `job` = `api-forum-api`
            - `uri` != `/actuator/prometheus`
        - Opera√ß√£o: `Fun√ß√µes de alcance` > `Avaliar` = 1m
        - Operador: `/`
        - Metric: `http_server_requests_seconds_count`
        - Label filters:
            - `application` = `$application` (vari√°vel criada anteriormente)
            - `instance` = `$instance` (vari√°vel criada anteriormente)
            - `job` = `api-forum-api`
            - `uri` != `/actuator/prometheus`
        - Opera√ß√£o: `Fun√ß√µes de alcance` > `Avaliar` = 1m
        - Op√ß√µes
            - Legenda: `Customizada` = `{{uri}} {{method}} {{status}}`
    - Visualiza√ß√£o: `S√©rie temporal (Time series)`
        - Op√ß√µes do painel
            - T√≠tulo: `RESPONSE TIME`
            - Descri√ß√£o: `Tempo de resposta no √∫ltimo minuto`
            - Legenda
                - Modo: `Tabela`
                - Posicionamento da legenda: `Direita`
                - Valores: `Min`, `Max`, `Mean`, `Last *`
        - Estilos de gr√°fico
            - Opacidade de preenchimento: 10
            - Modo gradiente: `Opacidade`
            - Mostrar pontos: `Nunca`
        - Op√ß√µes padr√µes
            - Unidade: `Tempo` > `segundo(s)`
        - Limites
            - Base: üü¢